<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: FormCreateTodo.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: FormCreateTodo.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React, {useRef} from "react";
import { db } from "../../firebase";
import { collection, addDoc } from "firebase/firestore";
import { useState } from "react";
import MyButton from "../Button/MyButton";
import classes from "./FormCreateToso.module.less";
import { ref, uploadBytesResumable, getDownloadURL } from "firebase/storage";
import { storage } from "../../firebase.js";
import PropTypes from "prop-types";

/**
 * Component for creating todo.
 *
 * @component
 * @example
 * const setProgress = 21
 * return (
 *   &lt;FormCreateTodo setProgress={setProgress}  />
 * )
 */

export default function FormCreateTodo({ setProgress }) {
  const [inputName, setInputName] = useState("");
  const [inputDate, setInputDate] = useState("");
  const [inputDescription, setInputDescription] = useState("");

  const inputRef = useRef(null);

  const resetFileInput = () => {
    inputRef.current.value = null;
  };

  const uploadFile = (file) => {
    if (!file) return;

    const storageRef = ref(storage, `/files/${file.name}`);
    const uploadTask = uploadBytesResumable(storageRef, file);

    uploadTask.on(
      "state_changed",
      (snapshot) => {
        const prog = Math.round(
          (snapshot.bytesTransferred / snapshot.totalBytes) * 100
        );

        setProgress(prog);
      },
      (err) => console.log(err),
      () => {
        getDownloadURL(uploadTask.snapshot.ref);
      }
    );
  };

  async function createTodo(e) {
    e.preventDefault();
    let file = e.target[3].files[0] || { name: "" };
    uploadFile(file);
    const storageRef = ref(storage, `/files/${file.name}`);
    const realRef = file.name ? await getDownloadURL(storageRef) : "";
    if (inputName) {
      await addDoc(collection(db, "todos"), {
        taskName: inputName,
        description: inputDescription,
        date: inputDate,
        done: false,
        fileName: file.name,
        fileUrl: realRef,
      });
      setInputName("");
      setInputDate("");
      setInputDescription('');
      file = "";
      resetFileInput();
    }
  }

  return (
    &lt;form className={classes.wrapper} onSubmit={createTodo}>
      &lt;label>name&lt;/label>
      &lt;input
        className={classes.input}
        type="text"
        placeholder="Todo name"
        onChange={(e) => setInputName(e.target.value)}
        value={inputName}
      >&lt;/input>
      &lt;label>description&lt;/label>
      &lt;textarea
        className={classes.input}
        type="text"
        placeholder="Todo description"
        onChange={(e) => setInputDescription(e.target.value)}
        value={inputDescription}
      >&lt;/textarea>
      &lt;label>date of completion &lt;/label>
      &lt;input
        className={classes.input}
        type="date"
        onChange={(e) => setInputDate(e.target.value)}
        value={inputDate}
      >&lt;/input>
      &lt;label>you can add a file to you todo&lt;/label>
      &lt;input ref={inputRef} className={classes.input} type="file">&lt;/input>
      {inputName &amp;&amp; inputDate ? (
        &lt;MyButton
          type="onSubmit"
          style={{ border: "2px solid coral", borderRadius: "5px" }}
        >
          Create todo
        &lt;/MyButton>
      ) : (
        &lt;>
          &lt;label>fields "name" and "date" are required&lt;/label>
          &lt;MyButton disabled>Create todo&lt;/MyButton>
        &lt;/>
      )}
    &lt;/form>
  );
}

FormCreateTodo.propTypes = {
  /**
   * setProgress
   */
   setProgress: PropTypes.number,

}

</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.0</a> on Sat Nov 19 2022 19:27:51 GMT+0400 (Самарское стандартное время)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
